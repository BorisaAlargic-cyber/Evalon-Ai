{% extends "base.html" %}
{% block content %}

<div class="p-10 text-white">

    <h1 class="text-3xl font-bold mb-8 border-l-4 pl-4 border-cyan-400">
        Model Performance Dashboard
    </h1>

    <!-- High‑level explanation -->
    <p class="mb-6 text-gray-300 max-w-3xl">
        This page summarizes how well the pricing model predicts apartment prices
        in Barcelona, Madrid and Valencia. The metrics below are computed on
        unseen listings, so they show how the model behaves in realistic
        conditions rather than on the training data.
    </p>

    <!-- Global Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Average Error (€)</h3>
            <p class="text-3xl font-bold">
                €{{ "%.0f"|format(mae) }}
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                On average, predictions are this many euros away from the
                actual listing price.
            </p>
        </div>

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Average % Error</h3>
            <p class="text-3xl font-bold">
                {{ "%.2f"|format(mape) }}%
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Typical prediction error as a percentage of the true price.
                Values around 1–6% indicate very accurate pricing.
            </p>
        </div>

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Variance Explained (R²)</h3>
            <p class="text-3xl font-bold">
                {{ "%.3f"|format(r2) }}
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Share of price variability captured by the model
                (1.0 would be perfect). Values above 0.95 are considered very strong
                for housing price prediction. [web:66][web:72]
            </p>
        </div>
    </div>

    <!-- City Breakdown -->
    <h2 class="text-2xl font-bold mb-4 border-l-4 pl-4 border-cyan-400">
        City‑level accuracy
    </h2>

    <p class="mb-4 text-gray-300 max-w-3xl">
        The table shows how performance changes by city. In all three markets,
        the model keeps the average percentage error in the single digits,
        while explaining most of the price variation. [web:67][web:72]
    </p>

    <div class="overflow-x-auto rounded-xl border border-[#3A4A6E] shadow-xl mb-12">
        <table class="min-w-full text-left text-gray-300">
            <thead>
                <tr class="table-header-dark text-xs uppercase tracking-wider">
                    <th class="p-4">City</th>
                    <th class="p-4">Avg error (€)</th>
                    <th class="p-4">Avg % error</th>
                    <th class="p-4">R² (variance explained)</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700 bg-[#202940]">
                {% for c in city_stats %}
                <tr class="hover:bg-[#2C3854] transition-colors">
                    <td class="p-4 font-bold text-cyan-300">
                        {{ c.city }}
                    </td>
                    <td class="p-4">
                        €{{ "%.0f"|format(c.mae) }}
                    </td>
                    <td class="p-4">
                        {{ "%.2f"|format(c.mape) }}%
                    </td>
                    <td class="p-4">
                        {{ "%.3f"|format(c.r2) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Interpretation block -->
    <div class="mb-10 max-w-3xl space-y-2 text-gray-300">
        <h2 class="text-xl font-bold text-cyan-300">
            How to read these numbers
        </h2>
        <p>
            • <span class="font-semibold">Low MAE</span> (a few thousand euros) means the model
            is usually very close to real market prices. [web:66]
        </p>
        <p>
            • <span class="font-semibold">Low MAPE</span> (around 1–6%) means predictions are
            typically within a few percent of the true price, even across
            different cities and property sizes. [web:68][web:73]
        </p>
        <p>
            • <span class="font-semibold">High R²</span> (above 0.95) shows that the model
            captures nearly all the variation in prices, which is competitive
            with results reported in house‑price prediction research. [web:72][web:75]
        </p>
    </div>

    <!-- Nav Button -->
    <a href="{{ url_for('dashboard') }}"
       class="px-6 py-3 bg-cyan-500 text-gray-900 font-bold rounded-lg hover:bg-cyan-400 transition">
        ⬅ Back to Dashboard
    </a>

</div>

{% endblock %}
