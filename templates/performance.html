{% extends "base.html" %}
{% block content %}

<div class="p-10 text-white">

    <h1 class="text-3xl font-bold mb-8 border-l-4 pl-4 border-cyan-400">
        Model Performance Dashboard
    </h1>

    <!-- High-level explanation -->
    <p class="mb-6 text-gray-300 max-w-3xl">
        This page summarizes how well the pricing model predicts apartment prices
        in Barcelona, Madrid and Valencia using unseen listings. The metrics
        describe how far predictions are from real market prices, both in euros
        and in percentage terms.
    </p>

    <!-- Global Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Average Error (€)</h3>
            <p class="text-3xl font-bold">
                €{{ "%.0f"|format(mae) }}
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Mean absolute difference between predicted and actual prices.
            </p>
        </div>

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Median Error (€)</h3>
            <p class="text-3xl font-bold">
                €{{ "%.0f"|format(medae) }}
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Half of all predictions are closer than this amount to the true price.
            </p>
        </div>

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Average % Error</h3>
            <p class="text-3xl font-bold">
                {{ "%.2f"|format(mape) }}%
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Typical error as a percentage of the real price; values in the
                low single digits indicate very accurate predictions.
            </p>
        </div>

        <div class="p-6 bg-[#1E293B] rounded-xl shadow-xl text-center">
            <h3 class="text-xl font-semibold mb-2 text-cyan-300">Variance Explained (R²)</h3>
            <p class="text-3xl font-bold">
                {{ "%.3f"|format(r2) }}
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Fraction of price variability captured by the model
                (1.0 would be perfect). Values above 0.95 are considered strong
                for housing price prediction.
            </p>
        </div>
    </div>

    <!-- City Breakdown -->
    <h2 class="text-2xl font-bold mb-4 border-l-4 pl-4 border-cyan-400">
        City-level accuracy
    </h2>

    <p class="mb-4 text-gray-300 max-w-3xl">
        Performance is also broken down by city to show where the model is most
        and least confident. In all three markets, the model keeps average
        percentage error in the single digits while explaining most of the price
        variation. [web:67][web:72]
    </p>

    <div class="overflow-x-auto rounded-xl border border-[#3A4A6E] shadow-xl mb-12">
        <table class="min-w-full text-left text-gray-300">
            <thead>
                <tr class="table-header-dark text-xs uppercase tracking-wider">
                    <th class="p-4">City</th>
                    <th class="p-4">Avg error (€)</th>
                    <th class="p-4">Median error (€)</th>
                    <th class="p-4">Avg % error</th>
                    <th class="p-4">R² (variance explained)</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700 bg-[#202940]">
                {% for c in city_stats %}
                <tr class="hover:bg-[#2C3854] transition-colors">
                    <td class="p-4 font-bold text-cyan-300">
                        {{ c.city }}
                    </td>
                    <td class="p-4">
                        €{{ "%.0f"|format(c.mae) }}
                    </td>
                    <td class="p-4">
                        €{{ "%.0f"|format(c.medae) }}
                    </td>
                    <td class="p-4">
                        {{ "%.2f"|format(c.mape) }}%
                    </td>
                    <td class="p-4">
                        {{ "%.3f"|format(c.r2) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Interpretation block -->
    <div class="mb-10 max-w-3xl space-y-2 text-gray-300">
        <h2 class="text-xl font-bold text-cyan-300">
            How to read these numbers
        </h2>
        <p>
            • <span class="font-semibold">Average error (MAE)</span> shows the
            typical money error in euros: lower is better.
        </p>
        <p>
            • <span class="font-semibold">Median error</span> is robust to a few
            extreme listings and describes the “typical” case for most
            properties.
        </p>
        <p>
            • <span class="font-semibold">Average % error (MAPE)</span> normalizes
            errors by price, so a €5k error on a €500k flat (1%) is treated
            differently from the same error on a €50k studio (10%).
        </p>
        <p>
            • <span class="font-semibold">R²</span> measures how much of the
            variance in prices the model explains. High R² together with low
            MAE/MAPE indicates both good fit and practically useful accuracy
            for price estimation.
        </p>
    </div>

    <!-- Nav Button -->
    <a href="{{ url_for('dashboard') }}"
       class="px-6 py-3 bg-cyan-500 text-gray-900 font-bold rounded-lg hover:bg-cyan-400 transition">
        ⬅ Back to Dashboard
    </a>

</div>

{% endblock %}
